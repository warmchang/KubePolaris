# 集群导入向导页面原型设计

## 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ Header: K8s管理平台 | 全局搜索框 | 用户头像▼                      │
├─────────────────────────────────────────────────────────────────┤
│ Sidebar │ Content Area                                          │
│ ├集群管理 │ ┌─────────────────────────────────────────────────┐ │
│ │├集群列表 │ │ 集群管理 > 导入集群                              │ │
│ │└导入集群 │ │                                                 │ │
│ ├节点管理 │ │ ┌─────────────────────────────────────────────┐ │ │
│ ├工作负载 │ │ │ 导入 Kubernetes 集群                         │ │ │
│ ├Pod管理  │ │ │ 请选择导入方式并填写相关信息                  │ │ │
│ ├全局搜索 │ │ └─────────────────────────────────────────────┘ │ │
│ └审计日志 │ │                                                 │ │
│          │ │ ┌─── 步骤导航 ───────────────────────────────┐ │ │
│          │ │ │ ① 选择方式 → ② 配置连接 → ③ 验证测试 → ④ 完成│ │ │
│          │ │ └─────────────────────────────────────────────┘ │ │
│          │ │                                                 │ │
│          │ │ ┌─────────────────────────────────────────────┐ │ │
│          │ │ │ 步骤1: 选择导入方式                          │ │ │
│          │ │ │                                             │ │ │
│          │ │ │ ┌─────────────┐ ┌─────────────┐            │ │ │
│          │ │ │ │📄 kubeconfig │ │🔑 Token方式  │            │ │ │
│          │ │ │ │上传配置文件   │ │手动配置认证  │            │ │ │
│          │ │ │ │[选中]        │ │             │            │ │ │
│          │ │ │ └─────────────┘ └─────────────┘            │ │ │
│          │ │ │                                             │ │ │
│          │ │ │ ┌─────────────────────────────────────────┐ │ │ │
│          │ │ │ │ 上传 kubeconfig 文件                     │ │ │ │
│          │ │ │ │ ┌─────────────────────────────────────┐ │ │ │ │
│          │ │ │ │ │ 拖拽文件到此处或点击上传             │ │ │ │ │
│          │ │ │ │ │ 支持 .yaml, .yml, .config 格式      │ │ │ │ │
│          │ │ │ │ └─────────────────────────────────────┘ │ │ │ │
│          │ │ │ └─────────────────────────────────────────┘ │ │ │
│          │ │ │                                             │ │ │
│          │ │ │ ┌──────────┐ ┌──────────┐                 │ │ │
│          │ │ │ │ 上一步    │ │ 下一步 → │                 │ │ │
│          │ │ │ └──────────┘ └──────────┘                 │ │ │
│          │ │ └─────────────────────────────────────────────┘ │ │
│          │ └─────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 导入流程设计

### 步骤1: 选择导入方式

#### 方式A: kubeconfig文件导入
```
┌─────────────────────────────────────────────────────────────┐
│ 📄 kubeconfig 文件导入                                       │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 📁 拖拽文件到此处或点击上传                              │ │
│ │    支持格式: .yaml, .yml, .config                       │ │
│ │    文件大小: 最大 1MB                                   │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 或者直接粘贴 kubeconfig 内容:                               │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ apiVersion: v1                                          │ │
│ │ kind: Config                                            │ │
│ │ clusters:                                               │ │
│ │ - cluster:                                              │ │
│ │     server: https://...                                 │ │
│ │ ...                                                     │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 方式B: Token手动配置
```
┌─────────────────────────────────────────────────────────────┐
│ 🔑 Token 手动配置                                            │
│                                                             │
│ 集群名称: ┌─────────────────────────────────────────────┐   │
│          │ prod-cluster                                │   │
│          └─────────────────────────────────────────────┘   │
│                                                             │
│ API Server: ┌───────────────────────────────────────────┐  │
│            │ https://k8s-api.example.com:6443         │  │
│            └───────────────────────────────────────────┘  │
│                                                             │
│ CA 证书: ┌─────────────────────────────────────────────┐   │
│         │ -----BEGIN CERTIFICATE-----                 │   │
│         │ MIIDXTCCAkWgAwIBAgIJAKZ...                  │   │
│         │ -----END CERTIFICATE-----                   │   │
│         └─────────────────────────────────────────────┘   │
│                                                             │
│ Service Account Token:                                      │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ eyJhbGciOiJSUzI1NiIsImtpZCI6Ik...                      │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 步骤2: 配置连接信息

```
┌─────────────────────────────────────────────────────────────┐
│ 步骤2: 配置连接信息                                          │
│                                                             │
│ 集群基本信息:                                               │
│ ┌─────────────────┐ ┌─────────────────┐                   │
│ │ 集群名称         │ │ 显示名称         │                   │
│ │ prod-k8s        │ │ 生产环境集群     │                   │
│ └─────────────────┘ └─────────────────┘                   │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 描述信息                                                 │ │
│ │ 生产环境 Kubernetes 集群，运行核心业务应用               │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 连接配置:                                                   │
│ ┌─────────────────┐ ┌─────────────────┐                   │
│ │ 连接超时(秒)     │ │ 心跳间隔(秒)     │                   │
│ │ 30              │ │ 60              │                   │
│ └─────────────────┘ └─────────────────┘                   │
│                                                             │
│ 标签 (可选):                                                │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ environment=production, region=us-west-1               │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 步骤3: 验证测试

```
┌─────────────────────────────────────────────────────────────┐
│ 步骤3: 连接验证                                              │
│                                                             │
│ 正在验证集群连接...                                          │
│                                                             │
│ ✅ API Server 连接                        [成功]            │
│ ✅ 证书验证                              [成功]            │
│ ✅ 权限检查                              [成功]            │
│ ✅ 集群信息获取                          [成功]            │
│ ⏳ 节点状态检查                          [进行中...]        │
│                                                             │
│ 集群信息预览:                                               │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 集群版本: v1.28.2                                       │ │
│ │ 节点数量: 5 个                                          │ │
│ │ 命名空间: 12 个                                         │ │
│ │ Pod 总数: 128 个                                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 权限检查结果:                                               │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✅ 读取节点信息                                          │ │
│ │ ✅ 读取 Pod 信息                                         │ │
│ │ ✅ 读取工作负载                                          │ │
│ │ ⚠️  创建/删除权限受限 (建议配置更高权限)                  │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 步骤4: 完成导入

```
┌─────────────────────────────────────────────────────────────┐
│ 🎉 集群导入成功!                                             │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 集群 "prod-k8s" 已成功添加到平台                         │ │
│ │                                                         │ │
│ │ 🟢 状态: 连接正常                                        │ │
│ │ 📊 节点: 5/5 就绪                                       │ │
│ │ 🚀 Pod: 128 个运行中                                    │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 下一步操作:                                                 │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│ │ 查看集群详情  │ │ 管理节点     │ │ 返回集群列表  │        │
│ └──────────────┘ └──────────────┘ └──────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

## 交互设计

### 文件上传组件
- **拖拽上传**: 支持拖拽文件到指定区域
- **点击上传**: 点击区域打开文件选择器
- **格式验证**: 自动检查文件格式和内容
- **实时预览**: 上传后显示文件内容预览

### 表单验证
- **实时验证**: 输入时即时验证格式
- **错误提示**: 清晰的错误信息和修复建议
- **必填标识**: 必填字段明确标识

### 连接测试
- **进度指示**: 显示测试进度和当前步骤
- **实时反馈**: 每个检查项的实时状态更新
- **错误诊断**: 失败时提供详细错误信息和解决方案

### 响应式设计
- **移动端**: 步骤导航改为垂直布局
- **平板端**: 调整表单布局，保持可用性

## Ant Design 组件映射

```jsx
<Steps current={currentStep} className="import-steps">
  <Step title="选择方式" />
  <Step title="配置连接" />
  <Step title="验证测试" />
  <Step title="完成" />
</Steps>

<Card title="导入 Kubernetes 集群">
  {currentStep === 0 && (
    <Radio.Group value={importMethod} onChange={setImportMethod}>
      <Radio.Button value="kubeconfig">
        <FileTextOutlined /> kubeconfig 文件
      </Radio.Button>
      <Radio.Button value="token">
        <KeyOutlined /> Token 方式
      </Radio.Button>
    </Radio.Group>
  )}
  
  {importMethod === 'kubeconfig' && (
    <Upload.Dragger
      accept=".yaml,.yml,.config"
      beforeUpload={validateKubeconfig}
      onChange={handleFileChange}
    >
      <InboxOutlined />
      <p>拖拽文件到此处或点击上传</p>
      <p>支持 .yaml, .yml, .config 格式</p>
    </Upload.Dragger>
  )}
  
  {currentStep === 2 && (
    <div className="validation-progress">
      <List
        dataSource={validationSteps}
        renderItem={item => (
          <List.Item>
            <List.Item.Meta
              avatar={<Icon type={item.status} />}
              title={item.title}
              description={item.description}
            />
          </List.Item>
        )}
      />
    </div>
  )}
</Card>
```

## 数据结构

```typescript
interface ImportWizardState {
  currentStep: number;
  importMethod: 'kubeconfig' | 'token';
  
  // kubeconfig 方式
  kubeconfigFile?: File;
  kubeconfigContent?: string;
  
  // token 方式
  clusterConfig?: {
    name: string;
    apiServer: string;
    caCert: string;
    token: string;
  };
  
  // 集群信息
  clusterInfo: {
    name: string;
    displayName: string;
    description?: string;
    timeout: number;
    heartbeatInterval: number;
    labels?: Record<string, string>;
  };
  
  // 验证结果
  validationResult?: {
    connection: ValidationStatus;
    certificate: ValidationStatus;
    permissions: ValidationStatus;
    clusterInfo: ValidationStatus;
    nodeStatus: ValidationStatus;
  };
}

interface ValidationStatus {
  status: 'pending' | 'success' | 'error' | 'warning';
  message?: string;
  details?: any;
}
```

## 错误处理

### 常见错误场景
1. **kubeconfig 格式错误**: 提供格式检查和修复建议
2. **API Server 无法连接**: 网络诊断和连接建议
3. **证书验证失败**: 证书问题诊断
4. **权限不足**: 权限要求说明和配置指导
5. **集群版本不兼容**: 版本兼容性说明

### 错误提示设计
- **图标**: 使用直观的错误图标
- **标题**: 简洁的错误描述
- **详情**: 详细的错误信息
- **建议**: 具体的解决方案
- **重试**: 提供重试机制
{{- if not .Values.security.existingSecret }}
{{- $secretName := printf "%s-secrets" (include "kubepolaris.fullname" .) }}
{{- $existingSecret := lookup "v1" "Secret" .Release.Namespace $secretName }}
{{- $jwtSecret := "" }}
{{- if .Values.security.jwtSecret }}
  {{- $jwtSecret = .Values.security.jwtSecret }}
{{- else if and $existingSecret $existingSecret.data (index $existingSecret.data "jwt-secret") }}
  {{- $jwtSecret = index $existingSecret.data "jwt-secret" | b64dec }}
{{- else }}
  {{- $jwtSecret = randAlphaNum 32 }}
{{- end }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "kubepolaris.labels" . | nindent 4 }}
type: Opaque
stringData:
  jwt-secret: {{ $jwtSecret | quote }}
{{- end }}
---
{{- if and .Values.mysql.internal.enabled (not .Values.mysql.internal.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubepolaris.fullname" . }}-mysql
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "kubepolaris.mysql.labels" . | nindent 4 }}
type: Opaque
stringData:
  mysql-root-password: {{ .Values.mysql.internal.rootPassword | default (randAlphaNum 16) | quote }}
  mysql-password: {{ .Values.mysql.internal.password | default (randAlphaNum 16) | quote }}
{{- end }}
---
{{- if and .Values.grafana.enabled (not .Values.grafana.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "kubepolaris.fullname" . }}-grafana
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "kubepolaris.labels" . | nindent 4 }}
    app.kubernetes.io/component: grafana
type: Opaque
stringData:
  grafana-admin-password: {{ .Values.grafana.adminPassword | default (randAlphaNum 16) | quote }}
{{- end }}

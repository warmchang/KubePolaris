"use strict";(globalThis.webpackChunkkubepolaris_docs=globalThis.webpackChunkkubepolaris_docs||[]).push([[962],{2074(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"installation/docker","title":"Docker \u90e8\u7f72","description":"\u4f7f\u7528 Docker \u548c Docker Compose \u90e8\u7f72 KubePolaris\uff0c\u9002\u5408\u5feb\u901f\u4f53\u9a8c\u548c\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u3002","source":"@site/docs/installation/docker.md","sourceDirName":"installation","slug":"/installation/docker","permalink":"/en/docs/installation/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/clay-wangzhi/KubePolaris/tree/main/website/docs/installation/docker.md","tags":[],"version":"current","lastUpdatedBy":"clay-wangzhi","lastUpdatedAt":1768448024000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"\u914d\u7f6e\u8bf4\u660e","permalink":"/en/docs/getting-started/configuration"},"next":{"title":"Kubernetes \u90e8\u7f72","permalink":"/en/docs/installation/kubernetes"}}');var r=s(4848),o=s(8453);const a={sidebar_position:1},i="Docker \u90e8\u7f72",c={},t=[{value:"\u524d\u7f6e\u8981\u6c42",id:"\u524d\u7f6e\u8981\u6c42",level:2},{value:"\u5feb\u901f\u90e8\u7f72",id:"\u5feb\u901f\u90e8\u7f72",level:2},{value:"1. \u83b7\u53d6\u4ee3\u7801",id:"1-\u83b7\u53d6\u4ee3\u7801",level:3},{value:"2. \u542f\u52a8\u670d\u52a1",id:"2-\u542f\u52a8\u670d\u52a1",level:3},{value:"3. \u9a8c\u8bc1\u90e8\u7f72",id:"3-\u9a8c\u8bc1\u90e8\u7f72",level:3},{value:"Docker Compose \u914d\u7f6e",id:"docker-compose-\u914d\u7f6e",level:2},{value:"\u9ed8\u8ba4\u914d\u7f6e",id:"\u9ed8\u8ba4\u914d\u7f6e",level:3},{value:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e",id:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e",level:3},{value:"\u81ea\u5b9a\u4e49\u914d\u7f6e",id:"\u81ea\u5b9a\u4e49\u914d\u7f6e",level:2},{value:"\u4f7f\u7528\u73af\u5883\u53d8\u91cf",id:"\u4f7f\u7528\u73af\u5883\u53d8\u91cf",level:3},{value:"\u6302\u8f7d kubeconfig",id:"\u6302\u8f7d-kubeconfig",level:3},{value:"\u542f\u7528 HTTPS",id:"\u542f\u7528-https",level:3},{value:"\u6570\u636e\u5907\u4efd",id:"\u6570\u636e\u5907\u4efd",level:2},{value:"\u5907\u4efd\u6570\u636e\u5e93",id:"\u5907\u4efd\u6570\u636e\u5e93",level:3},{value:"\u5907\u4efd\u6570\u636e\u5377",id:"\u5907\u4efd\u6570\u636e\u5377",level:3},{value:"\u5347\u7ea7",id:"\u5347\u7ea7",level:2},{value:"\u5347\u7ea7\u5230\u65b0\u7248\u672c",id:"\u5347\u7ea7\u5230\u65b0\u7248\u672c",level:3},{value:"\u56de\u6eda",id:"\u56de\u6eda",level:3},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"\u7aef\u53e3\u88ab\u5360\u7528",id:"\u7aef\u53e3\u88ab\u5360\u7528",level:3},{value:"\u5bb9\u5668\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc",id:"\u5bb9\u5668\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc",level:3},{value:"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25",id:"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25",level:3},{value:"\u4e0b\u4e00\u6b65",id:"\u4e0b\u4e00\u6b65",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"docker-\u90e8\u7f72",children:"Docker \u90e8\u7f72"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 Docker \u548c Docker Compose \u90e8\u7f72 KubePolaris\uff0c\u9002\u5408\u5feb\u901f\u4f53\u9a8c\u548c\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u524d\u7f6e\u8981\u6c42",children:"\u524d\u7f6e\u8981\u6c42"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Docker 20.10+"}),"\n",(0,r.jsx)(n.li,{children:"Docker Compose 2.0+"}),"\n",(0,r.jsx)(n.li,{children:"\u81f3\u5c11 4GB \u53ef\u7528\u5185\u5b58"}),"\n",(0,r.jsx)(n.li,{children:"\u81f3\u5c11 20GB \u53ef\u7528\u78c1\u76d8\u7a7a\u95f4"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5feb\u901f\u90e8\u7f72",children:"\u5feb\u901f\u90e8\u7f72"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u83b7\u53d6\u4ee3\u7801",children:"1. \u83b7\u53d6\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/clay-wangzhi/KubePolaris.git\ncd kubepolaris\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u542f\u52a8\u670d\u52a1",children:"2. \u542f\u52a8\u670d\u52a1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u542f\u52a8\u6240\u6709\u670d\u52a1\uff08\u540e\u53f0\u8fd0\u884c\uff09\ndocker-compose up -d\n\n# \u67e5\u770b\u542f\u52a8\u65e5\u5fd7\ndocker-compose logs -f\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u9a8c\u8bc1\u90e8\u7f72",children:"3. \u9a8c\u8bc1\u90e8\u7f72"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u67e5\u770b\u670d\u52a1\u72b6\u6001\ndocker-compose ps\n\n# \u5065\u5eb7\u68c0\u67e5\ncurl http://localhost:8080/api/health\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8bbf\u95ee ",(0,r.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})," \u5f00\u59cb\u4f7f\u7528\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"docker-compose-\u914d\u7f6e",children:"Docker Compose \u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u9ed8\u8ba4\u914d\u7f6e",children:"\u9ed8\u8ba4\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: \'3.8\'\n\nservices:\n  # MySQL \u6570\u636e\u5e93\n  mysql:\n    image: mysql:8.0\n    container_name: kubepolaris-mysql\n    restart: unless-stopped\n    environment:\n      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-kubepolaris123}\n      MYSQL_DATABASE: ${MYSQL_DATABASE:-kubepolaris}\n      MYSQL_CHARACTER_SET: utf8mb4\n      MYSQL_COLLATION: utf8mb4_unicode_ci\n    volumes:\n      - mysql_data:/var/lib/mysql\n    ports:\n      - "3306:3306"\n    healthcheck:\n      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  # KubePolaris \u540e\u7aef\n  backend:\n    image: kubepolaris/kubepolaris-backend:latest\n    container_name: kubepolaris-backend\n    restart: unless-stopped\n    depends_on:\n      mysql:\n        condition: service_healthy\n    environment:\n      - KUBEPOLARIS_DATABASE_HOST=mysql\n      - KUBEPOLARIS_DATABASE_PORT=3306\n      - KUBEPOLARIS_DATABASE_USER=root\n      - KUBEPOLARIS_DATABASE_PASSWORD=${MYSQL_ROOT_PASSWORD:-kubepolaris123}\n      - KUBEPOLARIS_DATABASE_NAME=${MYSQL_DATABASE:-kubepolaris}\n      - KUBEPOLARIS_JWT_SECRET=${JWT_SECRET:-please-change-this-secret}\n    volumes:\n      - ./configs:/app/configs:ro\n      - kubeconfig_data:/root/.kube:ro\n    ports:\n      - "8080:8080"\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # KubePolaris \u524d\u7aef\n  frontend:\n    image: kubepolaris/kubepolaris-frontend:latest\n    container_name: kubepolaris-frontend\n    restart: unless-stopped\n    depends_on:\n      - backend\n    ports:\n      - "80:80"\n\nvolumes:\n  mysql_data:\n  kubeconfig_data:\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e",children:"\u751f\u4ea7\u73af\u5883\u914d\u7f6e"}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u5efa\u8bae\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"docker-compose.prod.yml"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.prod.yml"',children:'version: \'3.8\'\n\nservices:\n  mysql:\n    image: mysql:8.0\n    container_name: kubepolaris-mysql\n    restart: always\n    environment:\n      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password\n      MYSQL_DATABASE: kubepolaris\n    volumes:\n      - mysql_data:/var/lib/mysql\n      - ./mysql/conf.d:/etc/mysql/conf.d:ro\n    secrets:\n      - mysql_root_password\n    deploy:\n      resources:\n        limits:\n          memory: 2G\n        reservations:\n          memory: 1G\n\n  backend:\n    image: kubepolaris/kubepolaris-backend:${VERSION:-latest}\n    container_name: kubepolaris-backend\n    restart: always\n    depends_on:\n      mysql:\n        condition: service_healthy\n    environment:\n      - KUBEPOLARIS_SERVER_MODE=release\n      - KUBEPOLARIS_DATABASE_HOST=mysql\n      - KUBEPOLARIS_DATABASE_PORT=3306\n      - KUBEPOLARIS_DATABASE_USER=root\n      - KUBEPOLARIS_DATABASE_NAME=kubepolaris\n      - KUBEPOLARIS_LOG_LEVEL=info\n      - KUBEPOLARIS_LOG_FORMAT=json\n    env_file:\n      - .env.prod\n    secrets:\n      - mysql_root_password\n      - jwt_secret\n    volumes:\n      - ./configs:/app/configs:ro\n      - logs:/app/logs\n    deploy:\n      resources:\n        limits:\n          memory: 2G\n        reservations:\n          memory: 512M\n    logging:\n      driver: "json-file"\n      options:\n        max-size: "100m"\n        max-file: "5"\n\n  frontend:\n    image: kubepolaris/kubepolaris-frontend:${VERSION:-latest}\n    container_name: kubepolaris-frontend\n    restart: always\n    depends_on:\n      - backend\n    ports:\n      - "443:443"\n      - "80:80"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/ssl:/etc/nginx/ssl:ro\n    deploy:\n      resources:\n        limits:\n          memory: 256M\n\nsecrets:\n  mysql_root_password:\n    file: ./secrets/mysql_root_password\n  jwt_secret:\n    file: ./secrets/jwt_secret\n\nvolumes:\n  mysql_data:\n  logs:\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u81ea\u5b9a\u4e49\u914d\u7f6e",children:"\u81ea\u5b9a\u4e49\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u4f7f\u7528\u73af\u5883\u53d8\u91cf",children:"\u4f7f\u7528\u73af\u5883\u53d8\u91cf"}),"\n",(0,r.jsxs)(n.p,{children:["\u521b\u5efa ",(0,r.jsx)(n.code,{children:".env"})," \u6587\u4ef6\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title=".env"',children:"# \u6570\u636e\u5e93\nMYSQL_ROOT_PASSWORD=your_secure_password\nMYSQL_DATABASE=kubepolaris\n\n# JWT\nJWT_SECRET=your-random-secret-key-at-least-32-chars\n\n# \u670d\u52a1\u7aef\u53e3\nBACKEND_PORT=8080\nFRONTEND_PORT=80\n\n# \u7248\u672c\nVERSION=v1.0.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6302\u8f7d-kubeconfig",children:"\u6302\u8f7d kubeconfig"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u9700\u8981\u7ba1\u7406\u672c\u5730 Kubernetes \u96c6\u7fa4\uff0c\u53ef\u4ee5\u6302\u8f7d kubeconfig\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"backend:\n  volumes:\n    - ~/.kube:/root/.kube:ro\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u542f\u7528-https",children:"\u542f\u7528 HTTPS"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 Let's Encrypt \u81ea\u52a8\u83b7\u53d6\u8bc1\u4e66\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'frontend:\n  image: kubepolaris/kubepolaris-frontend:latest\n  volumes:\n    - ./nginx/nginx-ssl.conf:/etc/nginx/nginx.conf:ro\n    - ./certbot/conf:/etc/letsencrypt:ro\n    - ./certbot/www:/var/www/certbot:ro\n  ports:\n    - "80:80"\n    - "443:443"\n\ncertbot:\n  image: certbot/certbot\n  volumes:\n    - ./certbot/conf:/etc/letsencrypt\n    - ./certbot/www:/var/www/certbot\n  entrypoint: "/bin/sh -c \'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;\'"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u6570\u636e\u5907\u4efd",children:"\u6570\u636e\u5907\u4efd"}),"\n",(0,r.jsx)(n.h3,{id:"\u5907\u4efd\u6570\u636e\u5e93",children:"\u5907\u4efd\u6570\u636e\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u5907\u4efd\ndocker exec kubepolaris-mysql mysqldump -u root -p kubepolaris > backup_$(date +%Y%m%d).sql\n\n# \u6062\u590d\ncat backup_20260107.sql | docker exec -i kubepolaris-mysql mysql -u root -p kubepolaris\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5907\u4efd\u6570\u636e\u5377",children:"\u5907\u4efd\u6570\u636e\u5377"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u5907\u4efd\ndocker run --rm -v kubepolaris_mysql_data:/data -v $(pwd):/backup alpine tar czf /backup/mysql_data.tar.gz /data\n\n# \u6062\u590d\ndocker run --rm -v kubepolaris_mysql_data:/data -v $(pwd):/backup alpine tar xzf /backup/mysql_data.tar.gz -C /\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5347\u7ea7",children:"\u5347\u7ea7"}),"\n",(0,r.jsx)(n.h3,{id:"\u5347\u7ea7\u5230\u65b0\u7248\u672c",children:"\u5347\u7ea7\u5230\u65b0\u7248\u672c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u62c9\u53d6\u65b0\u955c\u50cf\ndocker-compose pull\n\n# \u91cd\u542f\u670d\u52a1\ndocker-compose up -d\n\n# \u67e5\u770b\u65e5\u5fd7\u786e\u8ba4\u5347\u7ea7\u6210\u529f\ndocker-compose logs -f backend\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u56de\u6eda",children:"\u56de\u6eda"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528\u6307\u5b9a\u7248\u672c\nexport VERSION=v1.0.0\ndocker-compose up -d\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,r.jsx)(n.h3,{id:"\u7aef\u53e3\u88ab\u5360\u7528",children:"\u7aef\u53e3\u88ab\u5360\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u67e5\u770b\u7aef\u53e3\u5360\u7528\nlsof -i :8080\n\n# \u4fee\u6539\u7aef\u53e3\u6620\u5c04\n# \u5728 docker-compose.yml \u4e2d\u4fee\u6539 ports \u914d\u7f6e\nports:\n  - "9090:8080"  # \u4f7f\u7528 9090 \u7aef\u53e3\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u5bb9\u5668\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc",children:"\u5bb9\u5668\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7edc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5 Docker \u7f51\u7edc\ndocker network ls\ndocker network inspect kubepolaris_default\n\n# \u91cd\u5efa\u7f51\u7edc\ndocker-compose down\ndocker network prune\ndocker-compose up -d\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25",children:"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u68c0\u67e5 MySQL \u5bb9\u5668\u72b6\u6001\ndocker logs kubepolaris-mysql\n\n# \u6d4b\u8bd5\u8fde\u63a5\ndocker exec -it kubepolaris-mysql mysql -u root -p\n\n# \u68c0\u67e5\u73af\u5883\u53d8\u91cf\ndocker exec kubepolaris-backend env | grep DATABASE\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e0b\u4e00\u6b65",children:"\u4e0b\u4e00\u6b65"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./kubernetes",children:"Kubernetes \u90e8\u7f72"})," - \u751f\u4ea7\u73af\u5883\u63a8\u8350"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../getting-started/configuration",children:"\u914d\u7f6e\u8bf4\u660e"})," - \u8be6\u7ec6\u914d\u7f6e\u9879"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>i});var l=s(6540);const r={},o=l.createContext(r);function a(e){const n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);